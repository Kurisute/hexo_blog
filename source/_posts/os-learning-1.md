---
title: 操作系统学习笔记
date: 2020-04-26 21:29:59
categories: Learning Notes
tags: [Operating-System,Coursera]
---

曹奶奶在coursera上的操作系统课程，因为怕演话剧（雾？）大学没有选这门课，结果现在还得重新捞起来，sigh~

<!--more-->

## OS概述

#### OS的作用
 1. 资源管理功能：
    * 进程线程管理（CPU）
    * 存储管理
    * 文件管理
    * 设备管理
    * 用户接口
    
 2. 提供系统服务

 3. 拓展硬件机器

#### OS特征

 1. 并发(Concurrency)
    并发vs并行(parallel)
 2. 共享
    互斥共享 & 同时共享
 3. 虚拟
    分时 & 分空间
 4. 随机

#### 分类
 - 批处理OS：用户程序，数据，作业说明书；相同流程处理
 - SPOOLING技术（假脱机）：打印机
 - 分时OS：
 - 通用OS：分时优先，批处理在后
 - 实时OS：硬实时，软实时
 - PC OS
 - 网络OS
 - 分布式OS

#### 控制和状态寄存器
 - 程序计数器PC，指令寄存器IR，程序状态字PSW

#### 处理器状态
内核态，用户态

用户到内核转换方法：中断，陷入，异常

内核到用户：修改PSW

## 中断和异常
 | | | |
 | :---|:----|:------|
 | 中断 | 异步 | 返回下一指令 |
 | 陷入 | 同步 | 返回下一指令 |
 | 故障 | 同步 | 返回当前指令 |
 | 终止 | 同步 | 不返回 |

任务门，陷阱门，中断门，调用门

中断类型码存入IDTR，根据IDTR查IDT，得到 __段偏移__ ，根据条目中 __段选择符__ 查找GDT，得到段描述符中 __段基址__

中断处理程序入口 = 段基址 concat 段偏移

#### 系统调用（System Call）
中断异常机制

陷入指令（INT）

系统调用号和参数： __系统调用号__ 在eax，__参数__ 传到通用寄存器以及内存中

系统调用表

执行过程：
* 中断/异常
* 系统调用总入口：保存现场，保存参数，查系统调用表转移控制
* 执行例程
* 恢复控制

## 进程和线程

进程控制块PCB

#### 进程状态
* 5状态模型
    创建，就绪，运行，终止，阻塞
* 7状态模型
    创建，就绪，阻塞，推出，运行，就绪挂起，阻塞挂起

#### 进程控制
原语（primitive，原子操作 atomic action）：一次性完成，不能被打断

上下文切换：
 * 运行时，硬件状态在CPU寄存器中
 * 不运行时，硬件状态在PCB中

#### 线程

* 用户级线程（linux）
* 内核级线程（Win）
* 混合型线程（Solaris）:创建在用户空间，调度在核心态


## 进程调度

#### 时机
经过中断、陷入从内核态回到用户态时

#### 批处理系统
 * 先来先到FIFO
 * 最短作业优先SJF
 * 最短剩余时间优先SRTN
 * 最高响应比优先HRRN
    响应比 R = 1+（等待时间/运行时间）

#### 交互式系统

 * 时间片轮转
    plus:虚拟轮转法
 * 最高优先级调度算法
    优先级反转问题：设置优先级上限，优先级继承，使用中断禁止

#### 多级反馈队列调度算法（5.3BSD）
多个就绪队列，分配不同长度时间片，时间片长度随级别降低而增长

时间片轮转调度

新进程进入第一级队列

线程优先级提升（1-15级，可变优先级）:
* I/O操作完成（幅度由驱动程序决定）
* 信号量或事件等待结束
* 前台进程中线程完成一个等待操作
* 窗口活动唤醒窗口线程
* 发生饥饿现象（超过300始终间隔的线程，立即提升到15级,4倍时间配额，用完后恢复）

##同步和互斥

####进程互斥
各进程要共享使用临界资源（critical resource），产生竞争

对临界资源实施操作的代码区域称为 __临界区__ 

解决方案：
Dekker解法，Peterson解法
屏蔽中断，TSL（XCHG）指令

#### 进程同步

####信号量和PV操作
生产者和消费者问题
读着和写者问题（Linux中IPX协议）

## 进程通信

#### 管程monitor
是一个抽象数据类型
进程只能调用管程的过程来间接访问管程中数据

互斥进入：由编译器保证
同步：设置条件变量和等待/唤醒操作

#### HOARE管程
入口处设置等待队列
缺少资源的进程wait，在条件变量上等待（进入 __c链__ 队尾）
提供资源的进程signal唤醒c链第一个等待者，自己进入 __紧急等待队列__ 队尾（优先级高于入口）

#### MESA管程
缺少资源的进程wait，在条件变量上等待
提供资源的进程notify，自己继续进行，前一资源进入紧急队列
紧急队列中进程开始时，进行环境检查

改进：使用broadcast激活所有在c链上等待的进程

#### Pthread

#### 进程通信机制
##### 消息传递
发送进程 to 消息缓冲区 to 接收进程
send 和 receive
##### 共享内存
读者写者问题
##### 管道
字符流写入读出
FIFO
##### 套接字
##### 远程过程调用


